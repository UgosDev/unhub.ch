# Note di Sviluppo e Roadmap per scansioni.ch

Questo documento traccia le idee, la pianificazione e lo storico dello sviluppo dell'applicazione. √à organizzato in tre sezioni principali:
1.  **Roadmap**: Le prossime funzionalit√† prioritarie.
2.  **Backlog**: Un elenco categorizzato di idee e miglioramenti per il futuro.
3.  **Log di Sviluppo**: Lo storico cronologico delle modifiche apportate, versione per versione.

---

## 1. ROADMAP DI SVILUPPO (IDEE PRIORITARIE)

Elenco delle prossime funzionalit√† su cui concentrarsi.

### 1.1. Integrazione Pagamenti Reali
- **Problema**: Attualmente la gestione degli abbonamenti e dei pacchetti √® simulata.
- **Soluzione**: Integrare un sistema di pagamento reale (es. Stripe) per gestire gli abbonamenti mensili e l'acquisto di pacchetti di scansioni. Questo include la creazione di una UI per la gestione del piano da parte dell'utente.

---

## 2. BACKLOG DELLE IDEE (DA CONSIDERARE)

Lista di funzionalit√† e miglioramenti futuri, organizzati per categoria.

### Funzionalit√† Principali
- **Rubrica Mittenti**: Estrarre automaticamente i dati del mittente (nome, indirizzo) dai documenti scansionati per popolare una rubrica. Questa rubrica verr√† poi utilizzata nel modulo 'disdette.ch' per pre-compilare rapidamente i dati del destinatario.
- **Modalit√† Batch Asincrona**: Possibilit√† di inviare scansioni a un orario prestabilito (es. notte) a un costo ridotto. Richiede infrastruttura backend.
- **Potenziamento Esportazione PDF**: Aggiungere opzioni avanzate come la selezione della qualit√†, l'inclusione dei dati estratti e la protezione con password personalizzata per i PDF.
- **Metadati Avanzati**: Espandere i metadati per includere dati EXIF/XMP completi nelle immagini, offrendo una tracciabilit√† di livello professionale.
- **Integrazione Import da App di Messaggistica**: Aggiungere la possibilit√† di caricare documenti da scansionare direttamente da Telegram o WhatsApp. La prima fase si concentrer√† solo sull'importazione (input), con la gestione delle risposte (invio file modificati) da implementare in un secondo momento.

### UI/UX & Fotocamera
- **"Solidificazione" UI**: Revisione generale dell'interfaccia per migliorare la coerenza, gli spazi e l'impatto visivo.
- **Scansione Doppia Pagina (Modalit√† Libro)**: La fotocamera dovrebbe mostrare una guida per inquadrare due pagine di un libro contemporaneamente e dividerle automaticamente.
- **Pre-elaborazione Immagini**: Introdurre passaggi client-side (bianco e nero, contrasto, ottimizzazione peso) per migliorare la qualit√† dell'immagine inviata all'AI e ridurre i tempi di caricamento.

### Sicurezza, Monetizzazione e Infrastruttura
- **Backend per Passkey (WebAuthn)**: Completare l'implementazione della funzionalit√† di accesso con Passkey, attualmente simulata lato frontend.
  - **Endpoint di Registrazione**: Creare endpoint per generare la `challenge` di registrazione e per verificare la risposta del client, salvando la chiave pubblica in modo sicuro.
  - **Endpoint di Autenticazione**: Creare endpoint per generare la `challenge` di login e per verificare l'asserzione firmata dal client per concedere l'accesso.
  - **Gestione Credenziali**: Implementare la logica per la gestione (revoca) delle credenziali salvate.
- **Blocco Geografico e Rilevamento VPN**: Implementare un sistema backend per limitare l'accesso al servizio solo agli utenti in Svizzera e per bloccare l'uso di VPN/proxy per aggirare le restrizioni. Richiede integrazione con servizi di IP Intelligence.
- **Modalit√† "Lock"**: Nuova modalit√† a 45 SC che rende un documento scansionato a prova di manomissione, garantendo l'immutabilit√† anche nelle app partner.
- **Ricarica Automatica ScanCoin**: Impostare una soglia minima di saldo per la ricarica automatica (richiede integrazione pagamenti).
- **Pagina "Aiuta a Migliorare"**: Creare una sezione dove gli utenti possono contribuire a validare dati in cambio di crediti.
- **Pagina Hiring**: Pagina per future assunzioni.
- **Database Remoto**: Migrare da IndexedDB a un database cloud (es. Google Firebase/Firestore) per la persistenza dei dati utente tra dispositivi.
- **Pagine Legali**: Redigere e aggiungere pagine dettagliate per Privacy Policy e Termini di Servizio. (Testi segnaposto implementati, richiedono revisione legale).

---

## 3. LOG DI SVILUPPO (NOTE STORICHE)

Cronologia delle note di lavoro per ogni versione rilasciata.

# Note del 11/10/2025 - v9.3.0
- **Implementazione Modalit√† Fotografia**: Aggiunta una nuova modalit√† di scansione "Fotografia" per l'analisi semantica delle immagini.
- **Analisi AI**: La modalit√† utilizza il modello `gemini-2.5-flash` con "Thinking Mode" abilitato per descrivere e categorizzare il contenuto visivo delle immagini, senza estrarre testo.
- **Ricerca Semantica**: I dati generati (descrizioni dettagliate, categorie, tag) potenziano la ricerca semantica in `archivio.ch`, permettendo di trovare immagini con linguaggio naturale.
- **Costo**: La nuova modalit√† ha un costo di 50 ScanCoin per immagine.
- **Integrazione UI**: La modalit√† "Fotografia" √® stata integrata in tutti i componenti dell'interfaccia utente (selettore modalit√†, modale informativa, storico, filtri).
- Aggiornata tutta la documentazione e la versione a 9.3.0.

# Note del 10/10/2025 - v9.2.0
- **Implementazione Rubrica Mittenti**: Aggiunta una nuova funzionalit√† di rubrica per salvare automaticamente i mittenti dei documenti scansionati.
- **Estrazione AI**: L'analisi AI ora estrae `mittenteNome` e `mittenteIndirizzo` e li salva in una nuova raccolta `addressBook`.
- **Integrazione Disdette**: Il wizard di creazione disdette ora include un campo di ricerca con autocompletamento che pesca dalla rubrica, pre-compilando i dati del destinatario.
- **Salvataggio Automatico**: Anche i destinatari inseriti manualmente nel wizard vengono aggiunti o aggiornati nella rubrica per usi futuri.

# Note del 27/07/2025 - v6.16.0
- **Superpotenziamento Chatbot "Ugo"**: Implementate quattro nuove funzionalit√† avanzate per trasformare Ugo in un assistente proattivo:
  1. **Assistenza Proattiva**: All'apertura, Ugo analizza l'area di lavoro e offre suggerimenti (es. segnala documenti non sicuri, saldo basso, ecc.).
  2. **Esecuzione Azioni**: Ugo ora pu√≤ eseguire comandi dati in linguaggio naturale, come unire fascicoli specifici, rispondendo con un JSON che l'app interpreta.
  3. **Memoria a Lungo Termine**: La cronologia della chat √® ora salvata in IndexedDB, persistendo tra le sessioni.
  4. **Risposte Multimodali**: Ugo pu√≤ includere contenuti ricchi, come immagini, nelle sue risposte.
- Aggiornato `App.tsx` con la nuova logica, `services/db.ts` per la persistenza della chat e `components/Chatbot.tsx` per l'UI.
- Aggiornata tutta la documentazione e la versione a 6.16.0.

# Note del 26/08/2025 - v6.15.3
- **Potenziamento Chatbot "Ugo"**: Implementate quattro nuove funzionalit√† per migliorare l'esperienza della chat:
  1. **Saluti Contestuali**: Il messaggio di benvenuto di Ugo ora si adatta alla pagina corrente.
  2. **Risposte Rapide**: Ugo pu√≤ suggerire le prossime azioni con pulsanti interattivi.
  3. **Feedback Granulare**: Aggiunte icone üëç/üëé per valutare le risposte di Ugo.
  4. **Memoria Conversazione**: La cronologia della chat ora persiste durante la sessione del browser, anche dopo un ricaricamento della pagina.
- Aggiornato il file `App.tsx` con la logica di gestione (sessionStorage, parsing risposte) e il componente `Chatbot.tsx` per l'UI.
- Aggiornata la documentazione e la versione a 6.15.3.

# Note del 25/08/2025 - v6.15.2
- **Implementazione "Easter Egg"**: Implementato il sistema di ricompense "Utenti Gentili". Ora l'assistente 'Ugo' pu√≤ premiare gli utenti cordiali con ScanCoin bonus (50 SC), basandosi su un'analisi del sentiment della conversazione. La funzione si attiva discretamente dopo il terzo messaggio dell'utente ed √® limitata a una ricompensa per sessione per prevenire abusi.

# Note del 24/08/2025 - v6.15.1
- Soddisfatta una richiesta implicita dell'utente: la modalit√† demo non mostrava la nuova funzionalit√† di estrazione immagini.
- Aggiornato `services/demoData.ts` per generare un logo di esempio e includerlo in uno dei documenti demo.
- Il set di dati di esempio ora contiene un `ProcessedPageResult` con la propriet√† `extractedImages`, rendendo la feature visibile in modalit√† demo.
- Aggiornata la documentazione e la versione a 6.15.1.

# Note del 23/08/2025 - v6.15.0
- **Implementazione Estrazione Immagini**: Implementata la funzionalit√† di estrazione opzionale di immagini (loghi, firme) dai documenti.
- **UI**: Aggiunto un interruttore nel selettore di modalit√† per attivare la funzione (disponibile per le modalit√† `Chroma`, `Batch`, `Deep`, `Scontrino`).
- **AI Potenziata**: Migliorato il prompt di Gemini per un rilevamento pi√π preciso delle immagini rilevanti e per ottenere il `boundingBox` per il ritaglio.
- **Costo**: Introdotto un costo di 5 ScanCoin per ogni immagine estratta.
- **Visualizzazione**: I risultati ora mostrano le miniature delle immagini estratte, con possibilit√† di ingrandimento.
- Aggiornata tutta la documentazione e la versione a 6.15.0.

# Note del 22/08/2025 - v6.14.0
- **Implementazione "Proposta 2"** dall'analisi precedente: **Miglioramento Fotocamera (Ritaglio Manuale)**.
- Dopo lo scatto, l'utente viene ora portato a una nuova schermata `CropView`.
- In questa vista √® possibile trascinare i 4 angoli del documento per correggere il rilevamento automatico.
- Durante il trascinamento, una lente d'ingrandimento ("loupe") appare per consentire un posizionamento di alta precisione.
- L'utente pu√≤ confermare il ritaglio, che applica la correzione prospettica tramite OpenCV.js, o annullare e ripetere lo scatto.
- Aggiornata tutta la documentazione e la versione a 6.14.0.

# Note del 21/08/2025 - v6.13.0
- Implementata la "Proposta 1" dall'analisi precedente, focalizzata su robustezza e sicurezza.
  1. **Persistenza Coda di Lavoro**: La coda di elaborazione viene ora salvata in IndexedDB. Se l'applicazione viene ricaricata, l'elaborazione riprende automaticamente da dove era stata interrotta, prevenendo la perdita di lavoro.
  2. **Filtri di Sicurezza Gemini**: Attivati i filtri di sicurezza integrati di Gemini (`safetySettings`) per bloccare la generazione di contenuti potenzialmente dannosi (incitamento all'odio, molestie, ecc.), rendendo l'applicazione pi√π sicura e responsabile.
- Aggiornata la documentazione e la versione a 6.13.0.

# Note del 20/08/2025 - v6.12.0
- Migliorato il rilevamento dei documenti in `useDocumentScanner.tsx` (OpenCV) abbassando la soglia di area minima. Questo permette di riconoscere anche documenti piccoli come scontrini o fogli piegati, come richiesto dall'utente.
- Aggiornata la documentazione e la versione a 6.12.0.

# Note del 19/08/2025 - v6.11.0
- Implementata la "Modalit√† Scontrino" dal backlog.
- Creato un nuovo modello AI specializzato in `geminiService` per estrarre dettagliatamente le voci degli scontrini.
- Aggiunta la visualizzazione tabellare dei risultati in una sezione espandibile in `ResultsDisplay`.
- Aggiornata l'intera UI (selettore modalit√†, modale info, dashboard, profilo) per integrare la nuova modalit√†.
- Aggiornata tutta la documentazione e la versione a 6.11.0.

# Note del 18/08/2025 - v6.10.0
- Implementato un pacchetto di potenziamento basato sulle idee del backlog:
  1. **Esportazione PDF per Fascicolo**: Aggiunto un pulsante su ogni fascicolo per scaricarlo direttamente come un singolo file PDF multi-pagina.
  2. **Tentativi di Rianalisi Intelligenti**: Introdotta una logica che permette fino a 3 tentativi per correggere una scansione fallita o di bassa qualit√†. Il costo viene addebitato solo in caso di successo di una scansione precedentemente fallita. Il pulsante si disabilita dopo 3 tentativi.
- Aggiornata tutta la documentazione e la versione a 6.10.0.

# Note del 17/08/2025 - v6.9.9
- **Fix**: Risolto un fastidioso bug di scorrimento sulla pagina "Scansione" che si verificava su dispositivi mobili. Lo scroll tornava continuamente in cima alla pagina.
- Il problema √® stato risolto semplificando la struttura CSS del layout in `Workspace.tsx`, in particolare la gestione della colonna "sticky".
- Aggiornata la documentazione e la versione a 6.9.9.

# Note del 16/08/2025 - v6.9.8
- Implementata la configurazione delle modalit√† primarie da visualizzare nel selettore, gestibile dalla pagina Profilo.
- Migliorata l'UI del selettore modalit√†, che ora mostra le due modalit√† primarie e nasconde le altre in una sezione espandibile.
- Rinominato le modalit√† di scansione con nomi pi√π moderni e descrittivi.
- Aggiornata la documentazione e la versione a 6.9.8.

# Note del 15/08/2025 - v6.9.7
- Implementate diverse proposte dall'utente:
  1. **ZIP Protetto (Punto 1)**: I download sono ora protetti da password (`123456`).
  2. **Logo Navigabile (Punto 2)**: L'header ora reindirizza alla home page.
  3. **Esempi Scansioni (Punto 4)**: La pagina prezzi ora mostra stime del numero di scansioni per pacchetto.
  4. **Cookie Banner e Clarity (Punti 5, 6)**: Aggiunto banner per i cookie e script di Microsoft Clarity.
- Aggiornata tutta la documentazione e la versione a 6.9.7.

# Note del 14/08/2025 - v6.9.6
- Implementato un pacchetto di "vittorie rapide" basato sul feedback dell'utente:
  1. **Flash Automatico (Punto 2)**: Riabilitata la logica per l'attivazione automatica della torcia in `CameraView` e aggiunto un indicatore visivo dello stato del flash.
  2. **Indicatori Visivi per Modalit√† (Punto 6)**: Aggiunto un bordo laterale colorato a tutti gli elementi nella coda di lavoro (`QueueView`) e nei risultati (`ResultsDisplay`) per identificare a colpo d'occhio la modalit√† di elaborazione.
  3. **Selezione Modalit√† Sempre Attiva (Punto 5)**: Rimosso il blocco (`disabled`) dal selettore della modalit√† in `Workspace`, permettendo un flusso di lavoro pi√π fluido.
- Aggiornata la documentazione e la versione a 6.9.6.

# Note del 13/08/2025
- Aggiunta una lista di nuove idee e proposte fornite dall'utente al backlog per futura valutazione.
- Fornita un'analisi dettagliata delle proposte, raggruppandole per priorit√† e fattibilit√† (Vittorie Rapide, Funzionalit√† Chiave, Funzionalit√† Avanzate).

# Note del 12/08/2025 - v6.9.5
- Implementata la richiesta dell'utente di aggiungere una modalit√† gratuita "No-AI".
- Creata la nuova modalit√† "Acquisisci e Salva" a costo 0 ScanCoin.
- Questa modalit√† bypassa l'analisi Gemini, eseguendo solo l'acquisizione e l'applicazione del watermark.
- I risultati non hanno dati estratti e ogni scansione crea un fascicolo a s√©.
- Aggiornata tutta l'UI (selettore modalit√†, modale info, coda) e la documentazione per includere la nuova opzione.

# Note del 11/08/2025 - v6.9.3
- In risposta alla richiesta dell'utente, ho ripristinato lo storico delle sessioni, spostandolo dalla pagina Profilo alla Dashboard per una migliore centralizzazione delle informazioni.
- Aggiunto un pulsante per scaricare lo storico completo in formato PDF dalla Dashboard.
- Semplificata la pagina Profilo, che ora si concentra sui dati dell'account e le preferenze.
- Aggiornata la documentazione e la versione a 6.9.3.

# Note del 10/08/2025 - v6.9.4 (retrodatato per coerenza)
- Implementata la "Proposta 1" dall'analisi del file NotePersonali: il "Modello Libro".
- Aggiunta la nuova modalit√† di elaborazione "book" in `geminiService`, con costo e schema dedicati.
- Aggiornata l'UI in `ProcessingModeSelector`, `ModeInfoModal`, `ResultsDisplay` e `QueueView` per supportare la nuova modalit√†.
- Creata una nuova icona `BookOpenIcon`.
- Aggiornata tutta la documentazione (README, CHANGELOG, metadata) alla versione 6.9.4.

# Note del 29/07/2025 - v6.5.0
- Implementata una funzionalit√† dal backlog UI/UX: **Scheda Info per Modelli**.
- Creato il nuovo componente `ModeInfoModal.tsx` che mostra un popup di confronto per le modalit√†.
- Aggiunta l'icona e la logica per aprire il modale in `Workspace.tsx`.
- Aggiornata tutta la documentazione (README, CHANGELOG, metadata) alla versione 6.5.0.

# Note del 28/07/2025 - v6.4.0
- Implementata la "Proposta 1" (Performance): Il componente `VirtualItem` √® stato potenziato per "scaricare" gli elementi che escono dalla vista, implementando una virtualizzazione completa e migliorando drasticamente le performance con lunghe liste.
- Implementata la "Proposta 2" (Onboarding): Aggiunto un banner di benvenuto nell'area risultati (quando vuota) per guidare i nuovi utenti.
- Aggiornata tutta la documentazione (README, CHANGELOG, metadata) alla versione 6.4.0.

# Note del 27/07/2025 - v6.3.0
- Soddisfatta la richiesta dell'utente di rendere l'aggiornamento delle statistiche totali istantaneo. La logica √® stata spostata dalla funzione `handleClear` alla funzione `addResult`, che viene attivata per ogni pagina scansionata. Questo risolve la confusione per cui i totali si aggiornavano solo a fine sessione.
- "Pulisci Sessione" ora salva solo lo storico della sessione.
- Aggiornata tutta la documentazione (README, CHANGELOG, metadata) alla versione 6.3.0.

# Note del 26/07/2025 - v6.2.0
- **FIX CRITICO**: Corretto il prompt di Gemini in `geminiService.ts`. Le istruzioni per derivare i dati (`soggetto`, `titoloFascicolo`, ecc.) erano diventate contraddittorie, causando fallimenti nell'analisi AI e nell'estrazione del JSON. La logica √® stata resa pi√π sequenziale e chiara.
- **FIX USABILIT√Ä**: Rimosso il blocco (`disabled`) dal `ProcessingModeSelector` in `Workspace.tsx`. Ora l'utente pu√≤ cambiare la modalit√† di elaborazione per i file futuri anche mentre la coda corrente √® in esecuzione.
- Aggiornati tutti i file di documentazione e la versione a 6.2.0.

# Note del 25/07/2025 - v6.1.0
- Implementata la "Proposta 1" dalle note precedenti:
  - Aggiunta la barra di ricerca per i fascicoli.
  - Aggiunte scorciatoie da tastiera per Annulla/Ripristina, navigazione tra fascicoli e chiusura modali.
- Implementata la "Proposta 2":
  - Eseguito il refactoring completo di `CameraView.tsx` in tre custom hook (`useCameraStream`, `useDocumentScanner`, `useDeviceTilt`) per migliorare la manutenibilit√†.
- Aggiornati i file di documentazione e la versione a 6.1.0.

# Note del 24/07/2025 - v6.0.1
- **Fix Fotocamera Critici**: Risolti bug che impedivano lo scatto (manuale e automatico). Corretto il comportamento del flash perch√© illumini la scena durante la ricerca del documento. Stabilizzata l'intera esperienza di scatto.
- Aggiornata la documentazione e la versione a 6.0.1.

# Note del 23/07/2025 - v6.0.0
- **Major Version Bump**: Su richiesta dell'utente, la versione √® stata portata a 6.0.0 per riflettere l'importanza della reintroduzione e stabilizzazione della funzionalit√† di scansione con OpenCV.
- Le modifiche delle versioni 5.7.0 e 5.7.1 sono state consolidate sotto la nuova versione 6.0.0 nel CHANGELOG.
- L'obiettivo √® comunicare chiaramente che la funzionalit√† della fotocamera √® ora una feature principale e matura dell'applicazione.

# Note del 22/07/2025 - v5.7.1
- **Fix UI Fotocamera**: Ripristinata l'interfaccia della fotocamera al layout precedente che era pi√π funzionale e apprezzato dall'utente.
- Il problema era un disallineamento del canvas dell'overlay con il video, causato da tentativi di fix precedenti.
- La soluzione definitiva ha utilizzato CSS Grid per forzare la sovrapposizione perfetta di video e overlay, risolvendo tutti i problemi di layout.
- L'algoritmo di rilevamento potenziato (Canny + morfologia) √® stato mantenuto.
- Aggiornata la versione a 5.7.1.

# Note del 21/07/2025 - v5.7.0
- Implementato il rilevamento dei bordi e il ritaglio automatico tramite OpenCV.js.
- L'app ora mostra un contorno in tempo reale sul documento.
- Lo scatto viene automaticamente ritagliato e corretto nella prospettiva.
- La modalit√† "Scatto Rapido" √® stata potenziata per scattare solo quando un documento √® rilevato e il dispositivo √® in piano.
- Aggiornata la versione a 5.7.0.

# Note del 20/07/2025 - v5.6.0
- Implementata la "Modalit√† Scatto Rapido" nella fotocamera.
- Aggiunto un interruttore per attivarla e la logica per scattare automaticamente quando il dispositivo √® in piano.
- Aggiornata la versione a 5.6.0.

# Note del 19/07/2025 - v5.5.0
- Implementata la funzionalit√† di feedback per le singole scansioni. L'utente pu√≤ ora indicare se l'analisi di una pagina √® buona o cattiva.
- Aggiunto un campo opzionale `feedback` all'interfaccia `ProcessedPageResult`.
- Aggiornata la versione a 5.5.0 in tutti i file rilevanti (metadata, readme, changelog).

# Note del 18/07/2025 - v5.4.0
- La chat √® stata resa persistente, mantenendo la cronologia durante la navigazione. Lo stato √® stato spostato in `App.tsx`.
- Documentata la modifica e aggiornata la versione a 5.4.0.

# Note del 17/07/2025 - v5.3.0
Le seguenti modifiche sono state implementate:
- Eseguito il rebranding delle modalit√† di elaborazione con nomi pi√π commerciali:
  - `Qualit√†` -> `Pixel Perfect`
  - `Velocit√†` -> `Flash`
  - `Business` -> `Multi-Task`
- Aggiunto il costo per scansione (es. "0.10 CHF/scan") di fianco alla descrizione di ogni modalit√† per massima trasparenza.
- Aggiornata tutta l'interfaccia (risultati, coda, profilo) per riflettere i nuovi nomi.

# Note del 16/07/2025
Le seguenti modifiche sono state implementate nella versione 5.2.0:
- Aggiunti indicatori di modalit√† (con colore) e timestamp a ogni pagina scansionata per una maggiore chiarezza.
- Implementata una filigrana (watermark) con il timestamp sulle immagini elaborate.
- Introdotta la funzione "Riprova Scansione" per rielaborare le singole pagine fallite o di bassa qualit√†.
- Migliorata la gestione degli errori con messaggi pi√π dettagliati e specifici (connessione, API, file corrotto).
- Aggiornamento di versioning, README e changelog.

# Note del 15/07/2025
Le seguenti modifiche sono state implementate nella versione 5.1.0:
- Introduzione di un conteggio scansioni e costo lato client.
- Differenziazione dei costi per modalit√†:
    - Qualit√†: 0.10 CHF / pagina
    - Velocit√†: 0.07 CHF / pagina
    - Business: 0.15 CHF / pagina
- Aggiornamento di versioning, README e changelog.